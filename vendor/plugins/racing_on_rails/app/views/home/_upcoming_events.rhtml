<!-- Upcoming Races -->
<div class="base">
	<div class="caption">Upcoming Events</div>
	<div class="spacer">&nbsp;</div>
<%- for discipline in ['Road', 'Mountain Bike', 'Track', 'Cyclocross'] -%>
	<div class="discipline">
		<div class="header"><%= discipline %></div>
	<%- if @upcoming_events.events[discipline].empty? and @upcoming_events.weekly_series[discipline].empty? -%>
				None
    <%- else -%>
      <%- discipline_events = @upcoming_events.events[discipline] -%>
      <%- discipline_events.sort! -%>
		<%- for event in discipline_events -%>
		<div>
			<span class="date"><%= event.date_range_s %></span>
			<span class="info"><%= link_to(event.name, event.flyer) unless event.flyer.blank? -%><%= event.name if event.flyer.blank? -%></span>
		</div>
		<%- end -%>
		<%- for event in @upcoming_events.weekly_series[discipline].sort {|a, b|
				wday_diff = a.earliest_day_of_week.wday <=> b.earliest_day_of_week.wday
				if wday_diff == 0
					date_diff = a.date <=> b.date
					if date_diff == 0
						a.name <=> b.name
					else
						date_diff
					end
				else
					wday_diff
				end
		} -%>
		<div>
			<span class="date"><%= event.days_of_week_s %></span>
			<span class="info"><%= link_to(event.name, event.flyer) unless event.flyer.blank? -%><%= event.name if event.flyer.blank? -%> <small>(<%=
			    event.start_date.strftime("%m/%d") -%> - <%= event.end_date.strftime("%m/%d") -%>)</small>
			</span>
		</div>
		<%- end -%>
	<%- end -%>
	</div>
<%- end -%>
<div class="spacer">&nbsp;</div>
</div>
